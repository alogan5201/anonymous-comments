<!DOCTYPE html>
<html lang="en" dir="ltr">
    <%- include(`${partials}/movieLocationHead.ejs`, {pageTitle: 'Film Locations'}); -%>
    <body class="film-location film-details">
        <!--[if lt IE 8]>
      <p class="browserupgrade">
        You are using an <strong>outdated</strong> browser. Please
        <a href="http://browsehappy.com/">upgrade your browser</a> to improve
        your experience.
      </p>
<![endif]-->
        <noscript>
            <h3>Please enable JavaScript in order to view this site properly.</h3>
        </noscript>
        <%- include(`${partials}/nav`); -%>
        <main class="mb-4 mt-5">
            <div class="container px-4 px-lg-5">
                <%- include(`${partials}/autocomplete`); -%>
                <div class="row align-items-md-stretch">
                    <div class="col-md-12">
                        <div class="card mb-3" id="film-details">
                            <div class="row g-0">
                                <div class="col-md-8 px-3 py-3">
                                    <div class="card-body">
                                        <h3 class="card-title">Dersu Uzala</h3>
                                        <p class="card-text mb-0">
                                            <span id="mainPlotContent"> The Russian army sends an explorer on an expedition to the snowy Siberian wilderness where he makes friends with a seasoned local hunter. A Russian army explorer who is rescued in Siberia by a rugged Asian hunter renews his friendship with the woodsman years later when he returns as the head of a larger expedition. The hunter finds that all of his nature lore is of no help when he accompanies the explorer back to civilization. Keith Loh  In 1902, a Russian army expedition is assigned to explore Siberia under the command of Captain Vladimir Arseniev. He befriends the Goldi (Nanai) hunter Dersu Uzala and invites him to guide the explorers through the stark forest up to Khanka Lake. Along their journey, Arseniev discovers that Dersu Uzala is a... </span>
                                                
                                                    <div class="collapse" id="movieLocationCollapsible">
                                                        <span id="metaPlotContent"class="additional-information">  man with a beautiful soul, and they become close friends. When his assignment ends, Dersu Uzala says goodbye to Arseniev. In 1907, Captain Arseniev is assigned to another expedition at the Ussuri River; when he meets Dersu Uzala in the forest, the lonely hunter joins his team and guides the group. However, he is older and has problems with his vision, and Captain Arseniev invites Dersu Uzala to live with his family in Khabarovsk City. But the old man does not adapt to the urban lifestyle and decides to return to the forest. In 1910, Captain Arseniev is called to Korfovskaïa to identify the body of a man who has his calling card and might be Dersu Uzala. Claudio Carvalho, Rio de Janeiro, Brazil 1902. A group of Russian soldiers, led by Captain Vladimir Arseniev, are on assignment to survey the harsh wilderness of the Ussuri region of East Siberia. On their travels, they meet Dersu Uzala, a nomadic Goldi all alone in the world since smallpox took the lives of his wife and children, he who lives solely by hunting, both for food and what he can sell. From his knowledge of the land through which they must travel, Arseniev hires Dersu to be their guide. While Dersu's ways are seemingly simple to many of the soldiers, he and Arseniev form an emotional bond, for Arseniev because of Dersu's kindness not only toward him and the others, but his deep spirituality and wisdom about the life he leads. The story of their friendship is told, one that cannot be fully bridged due to the two very different worlds in which they generally inhabit. Huggo In 1902 a Russian army officer and his squad are tasked with exploring and mapping a remote part of Siberia. On their travels they meet a local hunter, Dersu Uzala, an old man determined to live his life in isolation. At their request he becomes their guide and over time a friendship forms between the officer and Dersu. grantss </span>
                                                    </div>
                                                    <p>
                                                        <a class="btn btn-link show-more-less collapsed"
                                                           id="myCollapsibleBtn"
                                                           role="button"></a>
                                                    </p>
                                                
                                            </p>
                                    </div>
                                </div>
                                <div class="col-md-4 justify-self-end">
                                        <img src="https://m.media-amazon.com/images/M/MV5BYWY0OWJlZTgtMWUzNy00MGJhLTk5YzQtNmY5MDEwOTIxNjMyXkEyXkFqcGdeQXVyNjc1NTYyMjg@.jpg"
                                             class="img-fluid rounded-start"
                                             alt="Dersu Uzala"/>
                                    </div>
                                </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="map-container">
                        <div id="map"></div>
                        <div id="loader">
                            <div class="spinner-border" role="status">
                                <span class="sr-only d-none">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
                <table class="table">
                    <tr class="table__header">
                        <th class="table__cell">Location</th>
                        <th class="table__cell">Coordiantes</th>
                    </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Primorsky Krai, Russia</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">45.33333</span>, <span class="lon">134.66667</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Siberia, Кош-Агачское, Altai 649780, Russia</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">50.013131</span>, <span class="lon">88.664002</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Москва, Moscow, Russia</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">55.75583</span>, <span class="lon">37.61778</span></a>
                            </td>
                        </tr>
                    </table>
            </div>
        </main>
        <%- include(`${partials}/footer`); -%> <%- include(`${partials}/page-scripts/movie-location-scripts`); -%>
        <script type="text/javascript">
var locations =[{"bbox": null, "data": [{"lat": 45.33333, "lon": 134.66667, "name": "Primorsky Krai, Russia"}, {"lat": 50.013131, "lon": 88.664002, "name": "Siberia, \u041a\u043e\u0448-\u0410\u0433\u0430\u0447\u0441\u043a\u043e\u0435, Altai 649780, Russia"}, {"lat": 55.75583, "lon": 37.61778, "name": "\u041c\u043e\u0441\u043a\u0432\u0430, Moscow, Russia"}]}];
var map = L.map('map').setView([0,0], 20);

const layer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
})


let locationData = locations[0].data
let tableCell = document.querySelectorAll('.table__cell a')

tableCell.forEach(box => {
  box.addEventListener('click', function handleClick(event) {
    event.preventDefault()
    let target = event.target
   let boxChildren = $(this).children()
   if(boxChildren.length < 1 ){
const found = locationData.find(element => element.name == target.innerText);

    let lat = found.lat
    let lon = found.lon
    let name = found.name
   map.flyTo([lat, lon])

    $('html,body').animate({                                                          //  fine in moz, still quicker in chrome.
        scrollTop: $("#map").offset().top},
        'slow');

   } else {

     let first = $(this).children().first().text()
     let second = $(this).children().last().text()
     let lat = parseFloat(first)
     let lon = parseFloat(second)
     console.log(lat,lon)
   map.flyTo([lat, lon])

    $('html,body').animate({                          
        scrollTop: $("#map").offset().top},
        'slow');
   }


});
});



const coords = []
    for (let index = 0; index < locations[0].data.length; index++) {
  const element = locations[0].data[index];
 coords.push([element.lat, element.lon])

  let marker = L.marker([element.lat, element.lon]);
  marker.bindPopup(element.name);
marker.addTo(map);

}

if(locations[0].bbox){

const box = locations[0].bbox
  console.log(JSON.stringify(box))
  map.fitBounds(box)
map.zoomOut(1);
}
else if (!locations[0].bbox){

  console.log('no box')
  console.log(locations[0].data[0].lat)
  let lat = locations[0].data[0].lat
  let lon = locations[0].data[0].lon
map.setView([lat, lon], 20);
}
layer.on('load', function (event) {
     document.getElementById('loader').classList.add('d-none')



});
layer.addTo(map);
        </script>
    </body>
</html>