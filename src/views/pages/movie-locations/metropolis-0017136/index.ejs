<!DOCTYPE html>
<html lang="en" dir="ltr">
    <%- include(`${partials}/movieLocationHead.ejs`, {pageTitle: 'Film Locations'}); -%>
    <body class="film-location film-details">
        <!--[if lt IE 8]>
      <p class="browserupgrade">
        You are using an <strong>outdated</strong> browser. Please
        <a href="http://browsehappy.com/">upgrade your browser</a> to improve
        your experience.
      </p>
<![endif]-->
        <noscript>
            <h3>Please enable JavaScript in order to view this site properly.</h3>
        </noscript>
        <%- include(`${partials}/nav`); -%>
        <main class="mb-4 mt-5">
            <div class="container px-4 px-lg-5">
                     <%- include(`${partials}/autocomplete`); -%>
                <div class="row align-items-md-stretch">
                    <div class="col-md-12">
                        <div class="card mb-3" id="film-details">
                            <div class="row g-0">
                                <div class="col-md-8 px-3 py-3">
                                    <div class="card-body">
                                        <h3 class="card-title">Metropolis</h3>
                                        <p class="card-text mb-0">
                                            <span id="mainPlotContent">In a futuristic city sharply divided between the working class and the city planners, the son of the city's mastermind falls in love with a working-class prophet who predicts the coming of a savior to mediate their differences. Sometime in the future, the city of Metropolis is home to a Utopian society where its wealthy residents live a carefree life. One of those is Freder Fredersen. One day, he spots a beautiful woman with a group of children, she and the children quickly disappear. Trying to follow her, he is horrified to find an underground world of workers who apparently run the machinery that keeps the Utopian world above ground functioning. One of the few people above ground who knows about the world below is Freder's father, John Fr...</span>
                                                
                                                    <div class="collapse" id="movieLocationCollapsible">
                                                        <div id = "module"></div>
                                                        <span id="metaPlotContent"class="additional-information">edersen, who is the founder and master of Metropolis. Freder learns that the woman is called Maria, who espouses the need to join the  hands  - the workers - to the  head  - those in power above - by a mediator who will act as the  heart . Freder wants to help the plight of the workers in their struggle for a better life. But when John learns of what Maria is advocating and that Freder has joined their cause, with the assistance of an old colleague. an inventor called Rotwang, who turns out to be But their nemesis goes to works towards quashing a proposed uprising, with Maria at the centre of their plan. John, unaware that Rotwang has his own agenda., makes plans that include shutting down the machines, with the prospect of unleashing total anarchy both above and below ground. Huggo In the future, the society of Metropolis is divided in two social classes: the workers, who live in the underground below the machines level, and the dominant classes that lives in the surface. The workers are controlled by their leader Maria, who wants to find a mediator between the upper class lords and the workers, since she believes that a heart would be necessary between brains and muscles. Maria meets Freder Fredersen, the son of the Lord of Metropolis Johhan Fredersen, in a meeting of the workers, and they fall in love for each other. Meanwhile, Johhan decides that the workers are no longer necessary for Metropolis, and uses a robot pretending to be Maria to promote a revolution of the working class and eliminate them. Claudio Carvalho, Rio de Janeiro, Brazil The future. Metropolis is a wonderful city, high above the ground its towers stand. The people prosper, the economy is flourishing, the suspended streets are busy. But Metropolis also has a great secret, so hidden that not even Freder Fredersen, son of founder John Fredersen knows about it. He is spending his free time in the Eternal Gardens, when suddenly a woman shows up, with what looks like a class of children. They're from the City of Workers, in the depth, Freder learns.  These are your brothers , she tells the children, before she is forced to leave. Freder is so intrigued he follows them into the depth and doesn't like what he sees. The workers are exploited, they must do labor like robots. Freder tries to convince his father to change, while the woman tries to keep workers' morale high by predicting a man will stand up that will mediate. Someone that will use both hands and head, someone that will be the heart. Arnoud Tiele (imdb@tiele.nl)</span>
                                                    </div>
                                                    <p>
                                                        <a class="btn btn-link show-more-less collapsed"
                                                               id="myCollapsibleBtn"
                                                      
                                                           role="button"
                                                       >
                                                        </a>
                                                    </p>
                                                
                                            </p>
                                    </div>
                                </div>
                                <div class="col-md-4 justify-self-end">
                                        <img src="https://m.media-amazon.com/images/M/MV5BMTg5YWIyMWUtZDY5My00Zjc1LTljOTctYmI0MWRmY2M2NmRkXkEyXkFqcGdeQXVyMTMxODk2OTU@.jpg"
                                             class="img-fluid rounded-start"
                                             alt="Metropolis"/>
                                    </div>
                                </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="map-container">
                        <div id="map"></div>
                        <div id="loader">
                            <div class="spinner-border" role="status">
                                <span class="sr-only d-none">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
                <table class="table">
                    <tr class="table__header">
                        <th class="table__cell">Location</th>
                        <th class="table__cell">Coordiantes</th>
                    </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Berlin, Germany</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">52.51667</span>, <span class="lon">13.38333</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Dublin, Ireland</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">53.3425</span>, <span class="lon">-6.26583</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Vienna, Austria</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">48.20833</span>, <span class="lon">16.37306</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Studio Babelsberg, August-Bebel-Str. 26-53, Potsdam, Brandenburg 14482, Germany</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">52.387806</span>, <span class="lon">13.120573</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Spandau, Berlin, Germany</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">52.535788</span>, <span class="lon">13.197792</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Marlene-Dietrich-Halle, Joseph-von-Sternberg-Str., Potsdam, Brandenburg 14482, Germany</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">52.387158</span>, <span class="lon">13.119628</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Ehlen, Habichtswald, Hesse, Germany</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">51.323325</span>, <span class="lon">9.310328</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Germany</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">51.1334813439932</span>, <span class="lon">10.0183432948567</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Austria</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">47.6077978292689</span>, <span class="lon">14.3001435907641</span></a>
                            </td>
                        </tr>
                    </tr>
            </table>
        </div>
    </div>
</main>
    <%- include(`${partials}/footer`); -%> <%- include(`${partials}/page-scripts/movie-location-scripts`); -%>

<script type="text/javascript">
var locations =[{"bbox": [[52.387158, 13.119628], [52.387806, 13.120573], [52.51667, 13.38333]], "data": [{"lat": 52.51667, "lon": 13.38333, "name": "Berlin, Germany"}, {"lat": 53.3425, "lon": -6.26583, "name": "Dublin, Ireland"}, {"lat": 48.20833, "lon": 16.37306, "name": "Vienna, Austria"}, {"lat": 52.387806, "lon": 13.120573, "name": "Studio Babelsberg, August-Bebel-Str. 26-53, Potsdam, Brandenburg 14482, Germany"}, {"lat": 52.535788, "lon": 13.197792, "name": "Spandau, Berlin, Germany"}, {"lat": 52.387158, "lon": 13.119628, "name": "Marlene-Dietrich-Halle, Joseph-von-Sternberg-Str., Potsdam, Brandenburg 14482, Germany"}, {"lat": 51.323325, "lon": 9.310328, "name": "Ehlen, Habichtswald, Hesse, Germany"}, {"lat": 51.1334813439932, "lon": 10.0183432948567, "name": "Germany"}, {"lat": 47.6077978292689, "lon": 14.3001435907641, "name": "Austria"}]}];
var map = L.map('map').setView([0,0], 20);

const layer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
})


let locationData = locations[0].data
let tableCell = document.querySelectorAll('.table__cell a')

tableCell.forEach(box => {
  box.addEventListener('click', function handleClick(event) {
    event.preventDefault()
    let target = event.target
    //console.log($(`${target} span`).first())

   let boxChildren = $(this).children()
   if(boxChildren.length < 1 ){
const found = locationData.find(element => element.name == target.innerText);

    let lat = found.lat
    let lon = found.lon
    let name = found.name
   map.flyTo([lat, lon])

    $('html,body').animate({                                                          //  fine in moz, still quicker in chrome.
        scrollTop: $("#map").offset().top},
        'slow');

   } else {

     let first = $(this).children().first().text()
     let second = $(this).children().last().text()
     let lat = parseFloat(first)
     let lon = parseFloat(second)
     console.log(lat,lon)
   map.flyTo([lat, lon])

    $('html,body').animate({                                                          //  fine in moz, still quicker in chrome.
        scrollTop: $("#map").offset().top},
        'slow');
   }


});
});



const coords = []
    for (let index = 0; index < locations[0].data.length; index++) {
  const element = locations[0].data[index];
 coords.push([element.lat, element.lon])

  let marker = L.marker([element.lat, element.lon]);
  marker.bindPopup(element.name);
marker.addTo(map);

}

if(locations[0].bbox){

const box = locations[0].bbox
  console.log(JSON.stringify(box))
  map.fitBounds(box)
map.zoomOut(1);
}
else if (!locations[0].bbox){

  console.log('no box')
  console.log(locations[0].data[0].lat)
  let lat = locations[0].data[0].lat
  let lon = locations[0].data[0].lon
map.setView([lat, lon], 20);
}
layer.on('load', function (event) {
     document.getElementById('loader').classList.add('d-none')



});
layer.addTo(map);
</script>
</body>
</html>