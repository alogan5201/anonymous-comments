<!DOCTYPE html>
<html lang="en" dir="ltr">
    <%- include(`${partials}/movieLocationHead.ejs`, {pageTitle: 'Film Locations'}); -%>
    <body class="film-location film-details">
        <!--[if lt IE 8]>
      <p class="browserupgrade">
        You are using an <strong>outdated</strong> browser. Please
        <a href="http://browsehappy.com/">upgrade your browser</a> to improve
        your experience.
      </p>
<![endif]-->
        <noscript>
            <h3>Please enable JavaScript in order to view this site properly.</h3>
        </noscript>
        <%- include(`${partials}/nav`); -%>
        <main class="mb-4 mt-5">
            <div class="container px-4 px-lg-5">
                <%- include(`${partials}/autocomplete`); -%>
                <div class="row align-items-md-stretch">
                    <div class="col-md-12">
                        <div class="card mb-3" id="film-details">
                            <div class="row g-0">
                                <div class="col-md-8 px-3 py-3">
                                    <div class="card-body">
                                        <h3 class="card-title">Eternal Sunshine of the Spotless Mind</h3>
                                        <p class="card-text mb-0">
                                            <span id="mainPlotContent"> When their relationship turns sour, a couple undergoes a medical procedure to have each other erased from their memories. Much to his surprise, timid Joel Barish is shocked to discover that the love of his life, sparky Clementine, has had him erased from her memory. To pay her back in the same coin, poor Joel summons up the courage to undergo a painless but intricate medical procedure to do the same, utterly unaware that darkness is an essential part of the light. Now, as hurt and angry Joel's ugly recollections of Clementine gradually fade away, giving way to a soulless black void, suddenly, he begins having second thoughts, toying with the idea of stopping the irreversible process. In the end, is ignorance really bliss? Nick Riganas A man... </span>
                                                
                                                    <div class="collapse" id="movieLocationCollapsible">
                                                        <span id="metaPlotContent"class="additional-information">  awakes disheveled; impulsively, he skips work, heading instead to the shore. On this chilly February day, a woman in orange, hair dyed blue, chats him up: she's Clementine, he's Joel, shy and sad; by day's end, he likes her. The next night she takes him to the frozen Charles River. After, as he drops her off, she asks to sleep at his place, and she runs up to get her toothbrush. Strange things occur: their meeting was not entirely chance, they have a history neither remembers. Our seeing how the lacunae came to be and their discovery of the memory loss take the rest of the film.  Joel is stunned to discover that his girlfriend Clementine has had her memories of their tumultuous relationship erased. Out of desperation, he contracts the inventor of the process, Dr. Howard Mierzwaik, to have Clementine removed from his own memory. But as Joel's memories progressively disappear, he begins to rediscover their earlier passion. From deep within the recesses of his brain, Joel attempts to escape the procedure. As Dr. Mierzwiak and his crew chase him through the maze of his memories, it's clear that Joel just can't get her out of his head. Focus Features On a Valentine Day, Joel Barish feels the impulse of going to Montauk instead of working. After spending the cold day on the beach, he meets Clementine Kruczynski on the train station and they have a crush on each other. Joel and Clementine do not know that they were mates in the past. Joel has just erased Clementine from his memories when he found that Clementine did exactly the same, when their relationship ended. However, along his erasing process, Joel becomes astonished when he finds that he still loves Clementine and he does not want to lose her, fighting for keeping the memories of their moments together instead. Claudio Carvalho, Rio de Janeiro, Brazil This is the story of a guy, Joel, who discovers that his long-time girlfriend, Clementine, has undergone a psychiatrist's experimental procedure in which all of her memory of Joel is removed, after the couple has tried for years to get their relationship working fluidly. Frustrated by the idea of still being in love with a woman who doesn't remember their time together, Joel agrees to undergo the procedure as well, to erase his memories of Clementine. The film, which takes place mostly within Joel's mind, follows his memories of Clementine backwards in time as each recent memory is replaced, and the procedure then goes on to the previous one, which is likewise seen, and then erased. Once the process starts, however, Joel realizes he doesn't really want to forget Clementine, so he starts smuggling her away into parts of his memory where she doesn't belong which alters other things about his memories as well... austin4577@aol.com </span>
                                                    </div>
                                                    <p>
                                                        <a class="btn btn-link show-more-less collapsed"
                                                           id="myCollapsibleBtn"
                                                           role="button"></a>
                                                    </p>
                                                
                                            </p>
                                    </div>
                                </div>
                                <div class="col-md-4 justify-self-end">
                                        <img src="https://m.media-amazon.com/images/M/MV5BMTY4NzcwODg3Nl5BMl5BanBnXkFtZTcwNTEwOTMyMw@@.jpg"
                                             class="img-fluid rounded-start"
                                             alt="Eternal Sunshine of the Spotless Mind"/>
                                    </div>
                                </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="map-container">
                        <div id="map"></div>
                        <div id="loader">
                            <div class="spinner-border" role="status">
                                <span class="sr-only d-none">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
                <table class="table">
                    <tr class="table__header">
                        <th class="table__cell">Location</th>
                        <th class="table__cell">Coordiantes</th>
                    </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Manhattan, New York, United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">40.789624</span>, <span class="lon">-73.959894</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Chinatown, New York, New York, United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">40.716491</span>, <span class="lon">-73.99625</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Mount Vernon, New York, United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">40.912582</span>, <span class="lon">-73.837079</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Marriott Vacation Club Pulse, 33 West 37th Street, New York, New York 10018, United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">40.751296</span>, <span class="lon">-73.984819</span></a>
                            </td>
                        </tr>
                    </table>
            </div>
        </main>
        <%- include(`${partials}/footer`); -%> <%- include(`${partials}/page-scripts/movie-location-scripts`); -%>
        <script type="text/javascript">
var locations =[{"bbox": [[40.716491, -73.99625], [40.751296, -73.984819], [40.789624, -73.959894]], "data": [{"lat": 40.789624, "lon": -73.959894, "name": "Manhattan, New York, United States"}, {"lat": 40.716491, "lon": -73.99625, "name": "Chinatown, New York, New York, United States"}, {"lat": 40.912582, "lon": -73.837079, "name": "Mount Vernon, New York, United States"}, {"lat": 40.751296, "lon": -73.984819, "name": "Marriott Vacation Club Pulse, 33 West 37th Street, New York, New York 10018, United States"}]}];
var map = L.map('map').setView([0,0], 20);

const layer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
})


let locationData = locations[0].data
let tableCell = document.querySelectorAll('.table__cell a')

tableCell.forEach(box => {
  box.addEventListener('click', function handleClick(event) {
    event.preventDefault()
    let target = event.target
   let boxChildren = $(this).children()
   if(boxChildren.length < 1 ){
const found = locationData.find(element => element.name == target.innerText);

    let lat = found.lat
    let lon = found.lon
    let name = found.name
   map.flyTo([lat, lon])

    $('html,body').animate({                                                          //  fine in moz, still quicker in chrome.
        scrollTop: $("#map").offset().top},
        'slow');

   } else {

     let first = $(this).children().first().text()
     let second = $(this).children().last().text()
     let lat = parseFloat(first)
     let lon = parseFloat(second)
     console.log(lat,lon)
   map.flyTo([lat, lon])

    $('html,body').animate({                          
        scrollTop: $("#map").offset().top},
        'slow');
   }


});
});



const coords = []
    for (let index = 0; index < locations[0].data.length; index++) {
  const element = locations[0].data[index];
 coords.push([element.lat, element.lon])

  let marker = L.marker([element.lat, element.lon]);
  marker.bindPopup(element.name);
marker.addTo(map);

}

if(locations[0].bbox){

const box = locations[0].bbox
  console.log(JSON.stringify(box))
  map.fitBounds(box)
map.zoomOut(1);
}
else if (!locations[0].bbox){

  console.log('no box')
  console.log(locations[0].data[0].lat)
  let lat = locations[0].data[0].lat
  let lon = locations[0].data[0].lon
map.setView([lat, lon], 20);
}
layer.on('load', function (event) {
     document.getElementById('loader').classList.add('d-none')



});
layer.addTo(map);
        </script>
    </body>
</html>