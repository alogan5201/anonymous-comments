<!DOCTYPE html>
<html lang="en" dir="ltr">
    <%- include(`${partials}/movieLocationHead.ejs`, {pageTitle: 'Film Locations'}); -%>
    <body class="film-location film-details">
        <!--[if lt IE 8]>
      <p class="browserupgrade">
        You are using an <strong>outdated</strong> browser. Please
        <a href="http://browsehappy.com/">upgrade your browser</a> to improve
        your experience.
      </p>
<![endif]-->
        <noscript>
            <h3>Please enable JavaScript in order to view this site properly.</h3>
        </noscript>
        <%- include(`${partials}/nav`); -%>
        <main class="mb-4 mt-5">
            <div class="container px-4 px-lg-5">
                     <%- include(`${partials}/autocomplete`); -%>
                <div class="row align-items-md-stretch">
                    <div class="col-md-12">
                        <div class="card mb-3" id="film-details">
                            <div class="row g-0">
                                <div class="col-md-8 px-3 py-3">
                                    <div class="card-body">
                                        <h3 class="card-title">The Green Mile</h3>
                                        <p class="card-text mb-0">
                                            <span id="mainPlotContent">The lives of guards on Death Row are affected by one of their charges: a black man accused of child murder and rape, yet who has a mysterious gift. Death Row guards at a penitentiary, in the 1930's, have a moral dilemma with their job when they discover one of their prisoners, a convicted murderer, has a special gift. Guy Johns Based on Stephen King's 1996 novel of the same name. Stars Tom Hanks as a death row corrections officer during the U.S. Great Depression who witnesses supernatural events that occur after an enigmatic inmate (Michael Clarke Duncan) is brought to his facility. MR_Heraclius It's just another normal day on the Green Mile for prison guard Paul Edgecomb. That is until huge John Coffey is sent there. Unlike the hulking bru...</span>
                                                
                                                    <div class="collapse" id="movieLocationCollapsible">
                                                        <div id = "module"></div>
                                                        <span id="metaPlotContent"class="additional-information">te that Coffey looks like, he is in fact kind at heart. Whilst watching over Coffey, Edgecomb learns that there is more to Coffey than can be seen. FilmFanUk</span>
                                                    </div>
                                                    <p>
                                                        <a class="btn btn-link show-more-less collapsed"
                                                               id="myCollapsibleBtn"
                                                      
                                                           role="button"
                                                       >
                                                        </a>
                                                    </p>
                                                
                                            </p>
                                    </div>
                                </div>
                                <div class="col-md-4 justify-self-end">
                                        <img src="https://m.media-amazon.com/images/M/MV5BMTUxMzQyNjA5MF5BMl5BanBnXkFtZTYwOTU2NTY3.jpg"
                                             class="img-fluid rounded-start"
                                             alt="The Green Mile"/>
                                    </div>
                                </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="map-container">
                        <div id="map"></div>
                        <div id="loader">
                            <div class="spinner-border" role="status">
                                <span class="sr-only d-none">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
                <table class="table">
                    <tr class="table__header">
                        <th class="table__cell">Location</th>
                        <th class="table__cell">Coordiantes</th>
                    </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Tennessee State University, 3500 John A Merritt Blvd, Nashville, Tennessee 37209, United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">36.1660335</span>, <span class="lon">-86.828839</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Shelbyville, Tennessee, United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">35.483406</span>, <span class="lon">-86.460272</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Blowing Rock, North Carolina, United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">36.135025</span>, <span class="lon">-81.677791</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Blue Ridge Mountains, Boone, North Carolina 28607, United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">36.195445</span>, <span class="lon">-81.656136</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Blue Ridge, Hendersonville, North Carolina, United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">35.350394</span>, <span class="lon">-82.362895</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Caney Fork River, Lancaster, TN 38569, Lancaster, Tennessee 38569, United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">36.138876</span>, <span class="lon">-85.813745</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Blowing Rock, North Carolina, United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">36.135025</span>, <span class="lon">-81.677791</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">College Grove, Tennessee, United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">35.788399</span>, <span class="lon">-86.674441</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Columbia, Tennessee, United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">35.615072</span>, <span class="lon">-87.035283</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Lewisburg, Tennessee, United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">35.44924</span>, <span class="lon">-86.788889</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Sunset Boulevard Heights, Los Angeles, California, United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">34.078145</span>, <span class="lon">-118.254504</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">North Carolina, United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">35.5568849207</span>, <span class="lon">-79.3896838690365</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Nashville, Tennessee, United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">36.162277</span>, <span class="lon">-86.774298</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Nolensville, Tennessee, United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">35.952285</span>, <span class="lon">-86.669441</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">4000 Warner Boulevard, Burbank, California 91522, United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">34.150955</span>, <span class="lon">-118.339232</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Blowing Rock, North Carolina, United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">36.135025</span>, <span class="lon">-81.677791</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">Tennessee, United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">35.9885949444</span>, <span class="lon">-85.9823352140893</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">7200 Santa Monica Boulevard, West Hollywood, California 90025, United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">34.090713</span>, <span class="lon">-118.346243</span></a>
                            </td>
                        </tr>
                    <tr class="table__row">
                            <td class="table__cell">
                                <a href="#">United States</a>
                            </td>
                            <td class="table__cell">
                                <a href="#"><span class="lat">39.3812661305678</span>, <span class="lon">-97.9222112121185</span></a>
                            </td>
                        </tr>
                    </tr>
            </table>
        </div>
    </div>
</main>
    <%- include(`${partials}/footer`); -%> <%- include(`${partials}/page-scripts/movie-location-scripts`); -%>

<script type="text/javascript">
var locations =[{"bbox": [[34.078145, -118.254504], [34.090713, -118.346243], [34.150955, -118.339232]], "data": [{"lat": 36.1660335, "lon": -86.828839, "name": "Tennessee State University, 3500 John A Merritt Blvd, Nashville, Tennessee 37209, United States"}, {"lat": 35.483406, "lon": -86.460272, "name": "Shelbyville, Tennessee, United States"}, {"lat": 36.135025, "lon": -81.677791, "name": "Blowing Rock, North Carolina, United States"}, {"lat": 36.195445, "lon": -81.656136, "name": "Blue Ridge Mountains, Boone, North Carolina 28607, United States"}, {"lat": 35.350394, "lon": -82.362895, "name": "Blue Ridge, Hendersonville, North Carolina, United States"}, {"lat": 36.138876, "lon": -85.813745, "name": "Caney Fork River, Lancaster, TN 38569, Lancaster, Tennessee 38569, United States"}, {"lat": 36.135025, "lon": -81.677791, "name": "Blowing Rock, North Carolina, United States"}, {"lat": 35.788399, "lon": -86.674441, "name": "College Grove, Tennessee, United States"}, {"lat": 35.615072, "lon": -87.035283, "name": "Columbia, Tennessee, United States"}, {"lat": 35.44924, "lon": -86.788889, "name": "Lewisburg, Tennessee, United States"}, {"lat": 34.078145, "lon": -118.254504, "name": "Sunset Boulevard Heights, Los Angeles, California, United States"}, {"lat": 35.5568849207, "lon": -79.3896838690365, "name": "North Carolina, United States"}, {"lat": 36.162277, "lon": -86.774298, "name": "Nashville, Tennessee, United States"}, {"lat": 35.952285, "lon": -86.669441, "name": "Nolensville, Tennessee, United States"}, {"lat": 34.150955, "lon": -118.339232, "name": "4000 Warner Boulevard, Burbank, California 91522, United States"}, {"lat": 36.135025, "lon": -81.677791, "name": "Blowing Rock, North Carolina, United States"}, {"lat": 35.9885949444, "lon": -85.9823352140893, "name": "Tennessee, United States"}, {"lat": 34.090713, "lon": -118.346243, "name": "7200 Santa Monica Boulevard, West Hollywood, California 90025, United States"}, {"lat": 39.3812661305678, "lon": -97.9222112121185, "name": "United States"}]}];
var map = L.map('map').setView([0,0], 20);

const layer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
})


let locationData = locations[0].data
let tableCell = document.querySelectorAll('.table__cell a')

tableCell.forEach(box => {
  box.addEventListener('click', function handleClick(event) {
    event.preventDefault()
    let target = event.target
    //console.log($(`${target} span`).first())

   let boxChildren = $(this).children()
   if(boxChildren.length < 1 ){
const found = locationData.find(element => element.name == target.innerText);

    let lat = found.lat
    let lon = found.lon
    let name = found.name
   map.flyTo([lat, lon])

    $('html,body').animate({                                                          //  fine in moz, still quicker in chrome.
        scrollTop: $("#map").offset().top},
        'slow');

   } else {

     let first = $(this).children().first().text()
     let second = $(this).children().last().text()
     let lat = parseFloat(first)
     let lon = parseFloat(second)
     console.log(lat,lon)
   map.flyTo([lat, lon])

    $('html,body').animate({                                                          //  fine in moz, still quicker in chrome.
        scrollTop: $("#map").offset().top},
        'slow');
   }


});
});



const coords = []
    for (let index = 0; index < locations[0].data.length; index++) {
  const element = locations[0].data[index];
 coords.push([element.lat, element.lon])

  let marker = L.marker([element.lat, element.lon]);
  marker.bindPopup(element.name);
marker.addTo(map);

}

if(locations[0].bbox){

const box = locations[0].bbox
  console.log(JSON.stringify(box))
  map.fitBounds(box)
map.zoomOut(1);
}
else if (!locations[0].bbox){

  console.log('no box')
  console.log(locations[0].data[0].lat)
  let lat = locations[0].data[0].lat
  let lon = locations[0].data[0].lon
map.setView([lat, lon], 20);
}
layer.on('load', function (event) {
     document.getElementById('loader').classList.add('d-none')



});
layer.addTo(map);
</script>
</body>
</html>